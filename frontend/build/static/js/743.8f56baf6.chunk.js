"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[743],{1743:(e,l,s)=>{s.r(l),s.d(l,{default:()=>I});var t=s(2791),r=s(71),a=s(3479),n=s(184);const d=e=>{let{offer:l,user:s,changeOffer:t}=e;const d=null===s||void 0===s?void 0:s._id,{order:i,product:o,messages:c,createdAt:u,offererUser:x}=l,m=i?i.name:o?o.name:"",{message:f,isRead:h,user:v}=c,p=i?i.images[0]:o?o.images[0]:null,g=x._id===d,j=v!==(null===s||void 0===s?void 0:s._id)&&!h;return(0,n.jsxs)("div",{onClick:t,className:"bg-white flex items-center hover:bg-grey-lighter cursor-pointer flex-row border-b pl-3",children:[(0,n.jsxs)("div",{children:[p?(0,n.jsx)("img",{alt:"alotrade.uz",className:"h-12 w-12 rounded-full",src:p}):(0,n.jsx)("div",{className:"h-12 w-12 rounded-full border-dashed bg-neutral-200 flex items-center justify-center",children:"IMG"}),(0,n.jsx)("p",{className:"text-xs text-neutral-600 mt-2",children:new Date(u).toLocaleDateString()})]}),(0,n.jsxs)("div",{className:"ml-4 flex-1 py-4 pr-2",children:[(0,n.jsxs)("div",{className:"flex items-bottom justify-between",children:[(0,n.jsx)("p",{className:"text-neutral-500 font-amazonbold h-6 overflow-hidden",children:m}),j&&(0,n.jsx)(a.RL9,{className:"fill-green-500",size:20})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("p",{className:"text-neutral-500 mt-1 text-sm h-6 overflow-hidden",children:f&&f}),(0,n.jsx)("p",{className:"text-xs text-neutral-600",children:g?(0,n.jsx)(r.uiN,{size:15,className:"rotate-45"}):(0,n.jsx)(r.xW6,{size:15,className:"rotate-45"})})]})]})]})};var i=s(763),o=s(2111),c=s.n(o),u=s(1087);const x=e=>{var l,s,t,a,d,o;let{data:x,translations:m}=e;if(!x)return null;const f=null===x||void 0===x?void 0:x.organization,h=null===x||void 0===x?void 0:x.user,v=f?m.tashkilot+": "+(null===f||void 0===f?void 0:f.name):m.foydalanuvchi+": "+(null===h||void 0===h?void 0:h.firstname)+" "+(null===h||void 0===h?void 0:h.lastname);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:"font-amazonbold py-2 text-lg border-y border-neutral-300",children:v}),(0,n.jsx)("h3",{className:"font-amazonbold py-1 font-bold",children:null===x||void 0===x?void 0:x.name}),(0,n.jsx)("h4",{className:"py-2 mb-2 block max-w-[300px]",children:(0,n.jsx)(c(),{element:"p",line:3,text:null===x||void 0===x?void 0:x.description})}),(0,n.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,n.jsx)("span",{className:"mr-2",children:(0,n.jsx)(r.kXE,{})}),(0,n.jsxs)("span",{children:[null===x||void 0===x||null===(l=x.region)||void 0===l?void 0:l.name,", ",null===x||void 0===x||null===(s=x.district)||void 0===s?void 0:s.name]})]}),(0,n.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,n.jsx)("span",{className:"mr-2",children:(0,n.jsx)(r.Ty1,{})}),(0,n.jsx)("span",{children:(null===x||void 0===x||null===(t=x.organization)||void 0===t?void 0:t.phone)||(null===x||void 0===x||null===(a=x.user)||void 0===a?void 0:a.phone)})]}),(0,n.jsx)(u.rU,{to:f?"/products/".concat(x._id):"/orders/".concat(x._id),className:"bg-orange-500 text-[12px] my-4 md:text-[16px] shadow-lg shadow- shadow-orange-600 text-white cursor-pointer px-3 py-1 text-center justify-center items-center rounded-xl flex space-x-2 flex-row",children:"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435"}),(0,n.jsxs)("p",{className:"flex items-center justify-between text-neutral-600 text-lg py-2 my-2 border-y border-neutral-300",children:[(0,n.jsxs)("span",{className:"pr-2 font-amazonbold",children:[m.narxi,": "]})," ",(0,n.jsxs)("span",{className:"text-amber-500 font-bold font-amazonbold ",children:[null!==x&&void 0!==x&&x.minPrice?(null===x||void 0===x||null===(d=x.minPrice)||void 0===d?void 0:d.toLocaleString("ru-RU"))+" - ":""," ",null===x||void 0===x||null===(o=x.maxPrice)||void 0===o?void 0:o.toLocaleString("ru-RU")," ",null===x||void 0===x?void 0:x.currency]})]}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(null===x||void 0===x?void 0:x.images)&&(0,i.map)(null===x||void 0===x?void 0:x.images,(e=>(0,n.jsx)("div",{className:"w-full flex items-center justify-center rounded bg-white-900 ",children:(0,n.jsx)("img",{className:"",alt:"alotrade",src:e})},(0,i.uniqueId)("productImage"))))})]})},m=e=>{let{message:l}=e;const{message:s,user:t,createdAt:r}=l;return(0,n.jsxs)("div",{className:"w-full flex flex-row gap-1 ml-1 my-3",children:[(0,n.jsx)("div",{className:"rounded-full bg-white w-15 flex justify-center items-center",children:null!==t&&void 0!==t&&t.image?(0,n.jsx)("img",{src:t.image,alt:"Alotarade",className:"w-12 h-12 rounded-full"}):(0,n.jsxs)("div",{className:"w-12 h-12 rounded-full uppercase flex items-center justify-center bg-white-900",children:[null===t||void 0===t?void 0:t.firstname[0],null===t||void 0===t?void 0:t.lastname[0]]})}),(0,n.jsxs)("div",{className:"w-2/3 bg-white rounded shadow-md px-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("h3",{className:"font-amazonbold text-neutral-500 text-[15px]",children:[null===t||void 0===t?void 0:t.firstname," ",null===t||void 0===t?void 0:t.lastname]}),(0,n.jsxs)("p",{className:"text-[12px] text-neutral-500 text-end",children:[new Date(r).toLocaleTimeString().slice(0,5)," ",new Date(r).toLocaleDateString()]})]}),(0,n.jsx)("p",{className:"text-neutral-600",children:s})]})]})},f=e=>{let{message:l}=e;const{message:s,user:t,createdAt:r}=l;return(0,n.jsxs)("div",{className:"w-full flex flex-row my-3 gap-1 justify-end",children:[(0,n.jsxs)("div",{className:"w-2/3 bg-white rounded shadow-md px-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("h3",{className:"font-amazonbold text-neutral-500 text-[15px]",children:[null===t||void 0===t?void 0:t.firstname," ",null===t||void 0===t?void 0:t.lastname]}),(0,n.jsxs)("p",{className:"text-[12px] text-neutral-500 text-end",children:[new Date(r).toLocaleTimeString().slice(0,5)," ",new Date(r).toLocaleDateString()]})]}),(0,n.jsx)("p",{className:"text-neutral-600",children:s})]}),(0,n.jsx)("div",{className:"rounded-full bg-white mr-1 w-15 flex justify-center items-center",children:null!==t&&void 0!==t&&t.image?(0,n.jsx)("img",{src:t.image,alt:"Alotarade",className:"w-12 h-12 rounded-full"}):(0,n.jsxs)("div",{className:"w-12 h-12 rounded-full uppercase flex items-center justify-center bg-white-900",children:[null===t||void 0===t?void 0:t.firstname[0],null===t||void 0===t?void 0:t.lastname[0]]})})]})};var h=s(9169),v=s(7879);const p=e=>{let{changeHandler:l,enterHandler:s,sendHandler:t,value:a}=e;const{t:d}=(0,v.$)(),{xabarni_kiriting:i}=(0,h.F)(d);return(0,n.jsxs)("div",{className:"bg-white-900 w-full h-[5rem] px-10 py-5 flex",children:[(0,n.jsx)("input",{value:a,onKeyUp:s,onChange:l,placeholder:i,className:"border rounded-l w-full py-1 px-3 outline-0"}),(0,n.jsx)("button",{onClick:t,className:"px-3 border-r border-y text-neutral-500 rounded-r",children:(0,n.jsx)(r.yhK,{color:"#fff"})})]})};var g=s(9434),j=s(7689),w=s(8285),b=s(6691),N=s(2106),y=s(9917);const _=(0,s(4428).ZP)("https://test.alotrade.uz/api"),k=JSON.parse(localStorage.getItem("_grecaptcha"));_.auth={token:k};const S=_;var z=s(4397);const U=e=>{let{data:l}=e;const s=null===l||void 0===l?void 0:l.organization;return(0,n.jsx)(u.rU,{to:s?"/products/".concat(null===l||void 0===l?void 0:l._id):"/orders/".concat(null===l||void 0===l?void 0:l._id),className:"text-white text-[14px] font-medium bg-orange-500 px-2 flex items-center justify-center",children:"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435"})},I=()=>{const e=(0,g.I0)(),l=(0,j.TH)(),{t:s}=(0,v.$)(["common"]),r=(0,h.F)(s),{width:a}=(0,z.Z)(),o=(0,t.useRef)(null),{userData:{user:c}}=(0,g.v9)((e=>e.login)),{offers:u,messages:_}=(0,g.v9)((e=>e.offers)),[k,I]=(0,t.useState)(null),[C,D]=(0,t.useState)(null),[H,q]=(0,t.useState)(null),[E,L]=(0,t.useState)(null),[R,T]=(0,t.useState)(""),[A,F]=(0,t.useState)(null),[O,P]=(0,t.useState)(null),[M,K]=(0,t.useState)(!1),Q=e=>{const l=e.target.name;P(l===O?null:e.target.name)},Z=e=>{T(e.target.value)},$=e=>{"Enter"===e.key&&G()},G=()=>{if(0===R.length)return(0,N.Ug)("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0432\u0432\u0435\u0434\u0435\u043d\u043e","warning");if(!H&&!E)return(0,N.Ug)(r.mahsulot_yoki_buyurtma_tanlanmagan,"warning");const l={message:R,product:H?H._id:void 0,order:E?E._id:void 0,offer:A?A._id:void 0};e(A?(0,y.tn)(l):(0,y.Cm)(l)).then((e=>{let{error:l,payload:{offer:s,message:t}}=e;l||(T(""),F(s),W({recipient:null===t||void 0===t?void 0:t.recipient}))}))},J=e=>{e.order&&(D("order"),I(e.order._id)),e.product&&(e.product&&D("product"),e.product&&I(e.product._id)),F(e),K(!0)},V=e=>(null===e||void 0===e?void 0:e._id)===(null===c||void 0===c?void 0:c._id),W=e=>{let{recipient:l}=e;S.emit("sendMessage",{recipient:l})};return(0,t.useEffect)((()=>{(()=>{var e;null===(e=o.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()}),[_]),(0,t.useEffect)((()=>{S.on("error",(e=>{let{id:l,message:s}=e;c._id===l&&(0,N.Ug)(s,"error")})),S.on("newMessage",(l=>{let{recipient:s}=l;const t=s===c._id;t&&e((0,y.Rg)()),t&&A&&e((0,y.Qi)({id:A._id})).then((l=>{let{error:s}=l;s||e((0,y.jd)({id:A._id}))}))}))}),[c,e,A]),(0,t.useEffect)((()=>{if(l.state){const s=l.state.type,t=l.state.id;I(t),D(s);const r={[s]:t};e((0,y.qU)(r)).then((l=>{let{error:s,payload:{offer:t}}=l;s||(F(t),!t&&e((0,y.nT)({messages:[]})))}))}else e((0,y.nT)({messages:[]})),L(null),q(null)}),[l.state,e]),(0,t.useEffect)((()=>{k&&("product"===C&&e((0,w.D)({id:k})).then((e=>{let{error:l,payload:{product:s}}=e;l||(L(null),q(s))})),"order"===C&&e((0,b.nF)({id:k})).then((e=>{let{error:l,payload:{order:s}}=e;l||(q(null),L(s))}))),K(!0)}),[k,C,e]),(0,t.useEffect)((()=>{e((0,y.Rg)({filter:O}))}),[e,O,c]),(0,t.useEffect)((()=>{A&&e((0,y.Qi)({id:A._id})).then((l=>{let{error:s}=l;s||e((0,y.jd)({id:A._id}))}))}),[e,A]),a<720?(0,n.jsxs)("div",{className:"flex flex-row h-full w-full relative",children:[(0,n.jsxs)("div",{className:"w-full md:max-w-[400px] md:min-w-[300px] md:w-1/4 h-full flex border-r-2 flex-col",children:[(0,n.jsxs)("div",{class:"flex justify-between md:gap-4 md:justify-center mb-[20px]",children:[(0,n.jsx)("button",{name:"offererUser",className:"block w-full md:w-auto uppercase shadow md:ml-0 rounded-tr-none rounded-br-none border-r-0 border-1 border-[#03c1f6cc] ".concat("offererUser"===O?"bg-alotrade text-white":" bg-white text-[#00c2cb]"," font-bold focus:shadow-outline focus:outline-none text-white md:text-xs text-[10px] py-3 md:px-10 px-2"),onClick:Q,children:"\u0418\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0435"}),(0,n.jsx)("button",{name:"user",className:"block w-full md:w-auto uppercase shadow md:ml-0 rounded-tl-none rounded-bl-none border-l-0 border-1 border-[#03c1f6cc] ".concat("user"===O?"bg-alotrade text-white":" bg-white text-alotrade"," font-bold focus:shadow-outline focus:outline-none text-white md:text-xs text-[10px] py-3 md:px-10 px-2"),onClick:Q,children:"\u0412\u0445\u043e\u0434\u044f\u0449\u0438\u0435"})]}),(0,n.jsx)("div",{className:"h-full w-full px-3 overflow-y-scroll",children:(0,i.map)(u,(e=>(0,n.jsx)(d,{changeOffer:()=>J(e),user:c,offer:e},(0,i.uniqueId)("chatUser"))))})]}),(0,n.jsxs)("div",{className:"h-full ".concat(M?"fixed top-0 left-0 w-full h-full z-50":"hidden"," md:w-1/2 md:relative bg-alotrade flex flex-col"),children:[(0,n.jsxs)("div",{className:"bg-alotrade border-b border-white h-[50px] flex justify-between pl-2",children:[(0,n.jsx)("button",{onClick:()=>K(!1),className:"text-white text-[14px] font-medium",children:"\u041d\u0430\u0437\u0430\u0434"}),(0,n.jsx)(U,{data:H||E})]}),(0,n.jsxs)("div",{className:"h-full overflow-y-scroll",children:[(0,i.map)(_,(e=>V(e.user)?(0,n.jsx)(f,{message:e},(0,i.uniqueId)("message")):(0,n.jsx)(m,{message:e},(0,i.uniqueId)("message")))),(0,n.jsx)("div",{className:"",ref:o})]}),(0,n.jsx)(p,{value:R,changeHandler:Z,enterHandler:$,sendHandler:G})]})]}):(0,n.jsxs)("div",{className:"flex flex-row h-screen w-full ",children:[(0,n.jsxs)("div",{className:"max-w-[400px] min-w-[300px] w-1/4 h-full flex border-r-2 flex-col",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{onClick:Q,name:"offererUser",className:"w-1/2 py-2 ".concat("offererUser"===O?"bg-primary-700":"bg-primary-800"," text-white-900 border-r border-white-900"),children:r.chiquvchi_xabar}),(0,n.jsx)("button",{onClick:Q,name:"user",className:"w-1/2 py-2 ".concat("user"===O?"bg-primary-700":"bg-primary-800"," text-white-900"),children:r.kiruvchi_xabar})]}),(0,n.jsx)("div",{className:"h-full w-full px-3",children:(0,i.map)(u,(e=>(0,n.jsx)(d,{changeOffer:()=>J(e),user:c,offer:e},(0,i.uniqueId)("chatUser"))))})]}),(0,n.jsxs)("div",{className:"h-full w-1/2 relative bg-alotrade flex flex-col",children:[(0,n.jsxs)("div",{className:"h-full",children:[(0,i.map)(_,(e=>V(e.user)?(0,n.jsx)(f,{message:e},(0,i.uniqueId)("message")):(0,n.jsx)(m,{message:e},(0,i.uniqueId)("message")))),(0,n.jsx)("div",{className:"",ref:o})]}),(0,n.jsx)(p,{value:R,changeHandler:Z,enterHandler:$,sendHandler:G})]}),(0,n.jsx)("div",{className:"max-w-[400px] min-w-[300px] w-1/4 h-full p-4 border-l-2 bg-white",children:(0,n.jsx)(x,{data:H||E,translations:r})})]})}}}]);
//# sourceMappingURL=743.8f56baf6.chunk.js.map